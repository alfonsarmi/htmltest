<div class="card p-4">
    <h1>Seguimiento de ofertas</h1>

    <div class="row">
        <div class="col-12 text-center">
            <app-loader-page *ngIf="loading"></app-loader-page>
        </div>
        <div class="col-12 col-md-6 col-xl-2" *ngIf="!loading">
            <label class="bolder mb-1">Fecha desde</label><br>
            <p-calendar styleClass="fechas" [locale]="es" [(ngModel)]="desde" dateFormat="dd/mm/yy"></p-calendar>
        </div>
        <div class="col-12 col-md-6 col-xl-2" *ngIf="!loading">
            <label class="bolder mb-1">Fecha hasta</label><br>
            <p-calendar styleClass="fechas" [locale]="es" [(ngModel)]="hasta" dateFormat="dd/mm/yy"></p-calendar>
        </div>
        <div [ngClass]="{'col-12': showSelector, 'col-md-6': showSelector}" *ngIf="!loading">
            <app-selector-cif-sfid (itemEvent)="sfidsOutput($event)" (shown)="showSelector($event)">
            </app-selector-cif-sfid>
        </div>
        <div class="col-12" *ngIf="!loading">
            <button class="btn btn-primary btn-consultar float-right" (click)="getSegOfertas()">Consultar</button>


        </div>
    </div>
</div>

<div class="card p-4 mt-3" *ngIf="ofertas || loadingData">
    <h2 class="red-vf">Ofertas</h2>













































































































    <app-loader-page *ngIf="loadingData"></app-loader-page>





















































    <p-table *ngIf="!loadingData" #dt [value]="ofertas" [paginator]="false" [rows]="20" [scrollable]="true" scrollHeight="15rem">
        <ng-template pTemplate="summary">
            <div class="ui-helper-clearfix" style="text-align: left">
                <button class="btn btn-primary float-right" (click)="exportExcel(ofertas)" [class.spinner]="loading" [disabled]="loading"><span [ngStyle]="loading ? {'visibility': 'hidden'} : ''">Exportar a Excel</span></button>
            </div>




        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <ng-container *ngFor="let oferta of ofertas | objectKeys">
                    <th class="min-width-col" pSortableColumn="oferta">{{oferta | uppercase }}
                        <p-sortIcon field="oferta"></p-sortIcon>
                    </th>
                </ng-container>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-ofer>
            <tr>
                <ng-container *ngFor="let item of ofertas | objectKeys">
                    <td class="min-width-col">{{ ofer[item] }}</td>
                </ng-container>
            </tr>
        </ng-template>
        <ng-template pTemplate="footer">
            <tr>
                <ng-container *ngFor="let item of ofertas | objectKeys; let i=index">
                    <td class="min-width-col" *ngIf="i === 0">TOTAL</td>
                    <ng-container *ngIf="i > 0">
                        <td class="min-width-col">{{ofertas | sumBy:item | number}}</td>
                    </ng-container>
                </ng-container>
            </tr>
        </ng-template>
    </p-table>
</div>



<div class="card p-4 mt-3" *ngIf="resumen || loadingData">
    <h2 class="red-vf">Resumen Propuestas Diarias</h2>

    <app-loader-page *ngIf="loadingData"></app-loader-page>

    <p-table *ngIf="!loadingData" #dt [value]="resumen" [paginator]="false" [rows]="20" [responsive]="true">
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="fecha">FECHA
                    <p-sortIcon field="fecha"></p-sortIcon>
                </th>
                <th pSortableColumn="propuestas">PROPUESTAS
                    <p-sortIcon field="propuestas"></p-sortIcon>
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-r>
            <tr>
                <td>{{r.fecha | date:'dd/MM/yyyy'}}</td>
                <td>{{r.propuestas}}</td>
            </tr>
        </ng-template>
        <ng-template pTemplate="footer">
            <tr>
                <td>TOTAL</td>
                <td>{{resumen | sumBy: 'propuestas' | number}}</td>
            </tr>
        </ng-template>
    </p-table>
</div>

<div class="card p-4 mt-3" *ngIf="detalle || loadingData">
    <h2 class="red-vf">Seguimiento estado general ofertas</h2>

    <app-loader-page *ngIf="loadingData"></app-loader-page>

    <p-table *ngIf="!loadingData" #dt [value]="detalle" [paginator]="true" [rows]="20" [responsive]="true" [autoLayout]="true" class="text-nowrap">
        <ng-template pTemplate="summary">
            <div class="ui-helper-clearfix" style="text-align: left">
                <button class="btn btn-primary float-right" (click)="exportExcel(detalle)" [class.spinner]="loading" [disabled]="loading"><span [ngStyle]="loading ? {'visibility': 'hidden'} : ''">Exportar a Excel</span></button>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th class="text-center" pSortableColumn="offerId">PRESUPUESTO
                    <p-sortIcon field="offerId"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_date">FECHA
                    <p-sortIcon field="created_date"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="sfid">SFID
                    <p-sortIcon field="sfid"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="pdv">PUNTO DE VENTA
                    <p-sortIcon field="pdv"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="usuario">COMERCIAL
                    <p-sortIcon field="usuario"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="cliente">CLIENTE
                    <p-sortIcon field="cliente"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="telefono">TELEFONO
                    <p-sortIcon field="telefono"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="nif">NIF
                    <p-sortIcon field="nif"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="segmento">SEGMENTO
                    <p-sortIcon field="segmento"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="cod_postal">C.P.
                    <p-sortIcon field="cod_postal"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="estado">ESTADO
                    <p-sortIcon field="estado"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="color">COLOR
                    <p-sortIcon field="color"></p-sortIcon>
                </th>
            </tr>
            <!-- <tr>
                <th>
                    <input pInputText type="text" (input)="dt.filter($event.target.value, 'offerId', 'contains')">
                </th>
            </tr> -->
        </ng-template>
        <ng-template pTemplate="body" let-d>
            <tr>
                <td>
                    <a [routerLink]="['/configurador/offer-detail', d.offerId]">{{d.offerId}}</a>
                </td>
                <td>{{d.created_date | date:'dd/MM/yyyy'}}</td>
                <td>{{d.sfid}}</td>
                <td>{{d.pdv}}</td>
                <td>{{d.usuario}}</td>
                <td>{{d.cliente}}</td>
                <td>{{d.telefono}}</td>
                <td>{{d.nif}}</td>
                <td>{{d.segmento}}</td>
                <td>{{d.cod_postal}}</td>
                <td [ngClass]="{'text-ok': d.id_estado==2, 'text-warning': d.id_estado==1, 'text-danger':d.id_estado==3}">
                    {{d.estado}}</td>
                <td ngClass="nba-{{ d.color.toLowerCase() }}">{{d.color}}</td>
            </tr>
        </ng-template>
    </p-table>
</div>


<div class="card p-4 mt-3" *ngIf="ofertasSecond || loadingData">
    <h2 class="red-vf">Seguimiento estado detalle ofertas</h2>

    <app-loader-page *ngIf="loadingData"></app-loader-page>
    <p-table *ngIf="!loadingData" #dt [value]="ofertasSecond" [paginator]="true" [rows]="20" [responsive]="true" [autoLayout]="true" class="text-nowrap">
        <ng-template pTemplate="summary">
            <div class="ui-helper-clearfix" style="text-align: left">
                <button class="btn btn-primary float-right" (click)="exportExcel(ofertasSecond)" [class.spinner]="loading" [disabled]="loading"><span [ngStyle]="loading ? {'visibility': 'hidden'} : ''">Exportar a Excel</span></button>
            </div>
        </ng-template>
        <ng-template pTemplate="header">
            <tr>
                <th class="text-center" pSortableColumn="offerId">PRESUPUESTO
                    <p-sortIcon field="offerId"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="created_date">FECHA
                    <p-sortIcon field="created_date"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="sfid">SFID
                    <p-sortIcon field="sfid"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="pdv">PUNTO DE VENTA
                    <p-sortIcon field="pdv"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="usuario">COMERCIAL
                    <p-sortIcon field="usuario"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="cliente">CLIENTE
                    <p-sortIcon field="cliente"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="telefono">TELEFONO
                    <p-sortIcon field="telefono"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="nif">NIF
                    <p-sortIcon field="nif"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="segmento">SEGMENTO
                    <p-sortIcon field="segmento"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="cod_postal">C.P.
                    <p-sortIcon field="cod_postal"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="estado">ESTADO
                    <p-sortIcon field="estado"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="color">COLOR
                    <p-sortIcon field="color"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="tipo">TIPO
                    <p-sortIcon field="tipo"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="Tipo_op">TIPO OPERACIÓN
                    <p-sortIcon field="Tipo_op"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="Tipo_op">OPERACIÓN
                    <p-sortIcon field="operacion"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="producto">PRODUCTO
                    <p-sortIcon field="producto"></p-sortIcon>
                </th>
                <th class="text-center" pSortableColumn="operador">OPERADOR
                    <p-sortIcon field="operador"></p-sortIcon>
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-d>
            <tr>
                <td>
                    <a [routerLink]="['/configurador/offer-detail', d.offerId]">{{d.offerId}}</a>
                </td>
                <td>{{d.created_date | date:'dd/MM/yyyy'}}</td>
                <td>{{d.sfid}}</td>
                <td>{{d.pdv}}</td>
                <td>{{d.usuario}}</td>
                <td>{{d.cliente}}</td>
                <td>{{d.telefono}}</td>
                <td>{{d.nif}}</td>
                <td>{{d.segmento}}</td>
                <td>{{d.cod_postal}}</td>
                <td [ngClass]="{'text-ok': d.id_estado==2, 'text-warning': d.id_estado==1, 'text-danger':d.id_estado==3}">{{d.estado}}</td>
                <td ngClass="nba-{{ d.color.toLowerCase() }}">{{d.color}}</td>
                <td>{{d.tipo}}</td>
                <td>{{d.Tipo_op}}</td>
                <td>{{d.operacion}}</td>
                <td>{{d.producto}}</td>
                <td>{{d.operador}}</td>
            </tr>
        </ng-template>
    </p-table>
</div>
No newline at end of file
